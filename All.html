<!-- ... Ù†ÙØ³ Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ... -->

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCLOEjRfXigGXljIiANe22x_SXRQDQKmbs",
    authDomain: "my-gob.firebaseapp.com",
    projectId: "my-gob",
    storageBucket: "my-gob.appspot.com",
    messagingSenderId: "464127979375",
    appId: "1:464127979375:web:dccc4c8ee64738cbac029a"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  const collectionsMap = {
    "messages": "Ø±Ø³Ø§Ù„Ø©",
    "news-comments": "Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¶Ø§Ø­ÙŠØ©",
    "General-news": "Ø£Ø®Ø¨Ø§Ø± Ø¹Ø§Ù…Ø©",
    "article-page": "Ø£Ø®Ø¨Ø§Ø± Ø¹Ø§Ø¬Ù„Ø©",
    "talents-comments": "Ù…ÙˆØ§Ù‡Ø¨",
    "clarifications-comments": "Ø¥Ø³ØªÙØ³Ø§Ø±Ø§Øª",
    "AD-comments": "Ø¥Ø¹Ù„Ø§Ù†Ø§Øª",
    "question-comments": "Ù…Ù‚Ø§Ù„Ø§Øª Ø£Ù‡Ù„ Ø§Ù„Ø¶Ø§Ø­ÙŠØ©"
  };

  const collections = Object.keys(collectionsMap);

  async function fetchComments(user) {
    const commentsList = document.getElementById("commentsList");
    commentsList.innerHTML = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶

    const allComments = [];

    // Ø¬Ù„Ø¨ Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let isAdmin = false;
    if (user) {
      const userDoc = await db.collection("users").doc(user.uid).get();
      isAdmin = userDoc.exists && userDoc.data().role === "admin";
    }

    for (let collectionName of collections) {
      const snapshot = await db.collection(collectionName)
        .orderBy("timestamp", "desc")
        .get();

      snapshot.forEach(doc => {
        const data = doc.data();
        const comment = {
          id: doc.id,
          collection: collectionName,
          text: data.text,
          imageUrl: data.imageUrl,
          userName: data.userName || "Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„",
          section: collectionsMap[collectionName],
          timestamp: data.timestamp?.toDate()
        };
        allComments.push(comment);
      });
    }

    allComments.sort((a, b) => b.timestamp - a.timestamp);

    allComments.forEach(comment => {
      const commentDiv = document.createElement("div");
      commentDiv.className = "comment";

      const formattedDate = comment.timestamp ? comment.timestamp.toLocaleString("ar-EG") : "ØºÙŠØ± Ù…ØªÙˆÙØ±";

      commentDiv.innerHTML = `
        <strong>${comment.userName}</strong><br/>
        ${comment.text || ""}<br/>
        <small>${formattedDate}</small><br/>
        <div class="section-name">Ø§Ù„Ù‚Ø³Ù…: ${comment.section}</div>
      `;

      if (comment.imageUrl) {
        const img = document.createElement("img");
        img.src = comment.imageUrl;
        commentDiv.appendChild(img);
      }

      // Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·
      if (isAdmin) {
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "ğŸ—‘ Ø­Ø°Ù";
        deleteBtn.style.marginTop = "10px";
        deleteBtn.style.backgroundColor = "#e53935";
        deleteBtn.style.color = "white";
        deleteBtn.style.border = "none";
        deleteBtn.style.padding = "5px 10px";
        deleteBtn.style.borderRadius = "5px";
        deleteBtn.style.cursor = "pointer";

        deleteBtn.onclick = async () => {
          if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ")) {
            await db.collection(comment.collection).doc(comment.id).delete();
            commentDiv.remove();
          }
        };
        commentDiv.appendChild(deleteBtn);
      }

      commentsList.appendChild(commentDiv);
    });
  }

  auth.onAuthStateChanged(user => {
    fetchComments(user);
  });
</script>
